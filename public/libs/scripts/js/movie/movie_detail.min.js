"use strict";$.support.cors=!0,$(function(){function e(e){return e<10?"0"+e:""+e}function t(t){return e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())}function i(){$(".topic-comment-del").off("click"),$(".topic-comment-reply").off("click"),$(".topic-comment-del").on("click",function(e){var t=$(this).parent().parent(),i=$(e.target).data("topicid"),a=$(e.target).data("cid"),n=$(e.target).data("crid");$.ajax({url:"/topicComment/:id?topicid="+i+"&cid="+a+"&crId="+n,type:"DELETE"}).done(function(e){0===e.success?t.remove():t.parent().remove()})}),$(".topic-comment-reply").on("click",function(e){e.preventDefault();var t=$(this),i=t.data("topicid"),a=t.data("cid"),n=t.data("tid");$("#topicMediaBody")&&$("#topicMediaBody").removeAttr("id"),$(t).parent().attr("id","topicMediaBody"),$("#topicToId").length>0&&$("#topicToId").remove(),$("<input>").attr({type:"hidden",id:"topicToId",name:"topicComment[tid]",value:n}).appendTo("#topicForm"+i),$("#topicCommentId").length>0&&$("#topicCommentId").remove(),$("<input>").attr({type:"hidden",id:"topicCommentId",name:"topicComment[cid]",value:a}).appendTo("#topicForm"+i),$("#modal"+i+" textarea").focus()})}$(".special.cards .image").dimmer({on:"hover"}),$(".ui.dropdown").dropdown();var a=15*Math.ceil($(".rating-num strong").html()-10);$(".star").css("background-position-y",a),$("#mediaList").on("click",".comment",function(e){e.preventDefault();var t=$(this),i=t.data("tid"),a=t.data("cid");$(t).parents(".media-body").attr("id","mediaBody"),$("#toId").length>0?$("#toId").val(i):$("<input>").attr({type:"hidden",id:"toId",name:"comment[tid]",value:i}).appendTo("#commentForm"),$("#commentId").length>0?$("#commentId").val(a):$("<input>").attr({type:"hidden",id:"commentId",name:"comment[cid]",value:a}).appendTo("#commentForm"),$("#comments textarea").focus()}),$("#comments button").on("click",function(e){e.preventDefault(),$.ajax({url:"/admin/movie/movieComment",type:"POST",data:{"comment[movie]":$('#comments input[name="comment[movie]"]').val(),"comment[from]":$('#comments input[name="comment[from]"]').val(),"comment[content]":$("#comments textarea").val(),"comment[tid]":$("#toId").val(),"comment[cid]":$("#commentId").val()}}).done(function(e){var i=e.data||{};if(console.log(i),i.reply.length){var a=i.reply.length;$("#mediaBody").append('<div class="media"><div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 30px; height: 30px;"/></div><div class="media-body"><h4  class="media-heading">'+i.reply[a-1].from.name+"<span>&nbsp;回复&nbsp;</span>"+i.reply[a-1].to.name+"</h4><p>"+i.reply[a-1].content+'</p><span class="createAt">'+t(new Date)+'</span>&nbsp;&nbsp;&nbsp;&nbsp;<a class="comment" href="#comments" data-cid='+i._id+" data-tid="+i.reply[a-1].to._id+'> 回复</a>&nbsp;|&nbsp;<a class="comment-del" href="javascript:;" data-cid='+i._id+" data-did="+i.reply[a-1]._id+">删除</a></div></div>")}else{$("#mediaList").append('<li class="media"><div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 40px; height: 40px;" /></div><div class="media-body"><h4 class="media-heading">'+i.from.name+"</h4><p>"+i.content+'</p><span class="createAt">'+t(new Date)+'</span>&nbsp;&nbsp;&nbsp;&nbsp;<a class="comment" href="#comments" data-cid='+i._id+" data-tid="+i.from._id+'> 回复</a>&nbsp;|&nbsp;<a class="comment-del" href="javascript:;" data-cid='+i._id+">删除</a></div><hr></li>");try{var n=$("#comment-length");n.html(parseInt(n.html())+1)}catch(o){console.log(o)}}$("#comments textarea").val(""),$("#mediaBody").removeAttr("id"),$("#commentForm input:gt(1)").remove()})}),$("#mediaList").on("click",".comment-del",function(e){var t=$(this).parent(".media-body"),i=$(e.target).data("cid"),a=$(e.target).data("did");$.ajax({url:"/movie/:id?cid="+i+"&did="+a,type:"DELETE"}).done(function(e){if(1===e.success){t.parent().remove();try{var i=$("#comment-length");i.html(parseInt(i.html())-1)}catch(a){console.log(a)}}})}),$("#topic-guide-close").on("click",function(e){$("#topic-guide").hide()}),$("#publish-toppic-btn").on("click",function(e){$("#topic-publish-modal").modal("show")}),$(".show-modal-btn").on("click",function(e){console.log(this.id),$("#modal"+this.id).modal("show"),$("input").blur(),$("#bootstrapJs").hide()}),$("#publishButton").on("click",function(e){e.preventDefault(),$.ajax({url:"/admin/movie/movieTopic",type:"POST",dataType:"json",data:{"topic[movie]":$('#topic-publish-modal input[name="topic[movie]"]').val(),"topic[publisher]":$('#topic-publish-modal input[name="topic[publisher]"]').val(),"topic[title]":$('#topic-publish-modal input[name="topic[title]"]').val(),"topic[body]":$('#topic-publish-modal textarea[name="topic[body]"]').val()}}).done(function(e){var t=e.data||{},i=e.createAt||{};$("#topicBody").append('<div id="box-'+t._id+'" ><h3><a id='+t._id+' href="javascript:void(0);"class="show-modal-btn">'+t.title+'</a><span class="tag right">\n                    <div tabindex="0" class="ui inline dropdown">\n                      <div class="text"></div><i class="dropdown icon"></i>\n                      <div tabindex="-1" class="menu transition hidden">\n                        <div class="item"><span style="color:red" data-did='+t._id+' class="tag topic-del">删除</span></div>\n                      </div>\n                    </div></span></h3>\n<div><span class="tag">'+i+'</span><span class="tag right"><span>浏览(0)</span><span>留言(0)</span></span></div><hr></div>'),$(".show-modal-btn:last").on("click",function(e){$("#modal"+t._id).modal("show"),$("input").blur()}),$(".topic-del").on("click",function(e){e.preventDefault();var t=$(this),i=t.data("did");$.ajax({url:"/topic/:id?topicid="+i,type:"DELETE"}).done(function(e){1===e.success&&$("#box-"+i).remove()})}),$(".ui.dropdown").dropdown(),$("#topic-hidden").append('<div id="modal'+t._id+'" class="ui modal publish large long"><i class="close icon"></i>\n          <div class="header">'+t.title+'</div>\n          <div class="content">\n            <form method="post" class="ui form segment">\n              <input type="hidden" name="topic[movie]" value="5c3e980c944b741c5097aafc">\n              <input type="hidden" name="topic[publisher]" value="5c7e5905434e9b0c308d1371">\n              <div class="field">\n                <label>内容</label>'+t.body+'              </div>\n            </form>\n          </div>\n          <div class="actions">\n            <ul class="media-list">\n              <li class="media">\n                <div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 40px; height: 40px;" class="media-object"></div>\n                <div class="media-body">\n                  <div class="topicComments">\n                    <form method="POST">\n                      <input type="hidden" name="topicComment[movie]" value="5c3e980c944b741c5097aafc">\n                      <input type="hidden" name="topicComment[topicId]" value="5c7fce0f2ae18018a41b90b5">\n                    </form>\n                    <input type="hidden" name="topicComment[from]" value="5c7e5905434e9b0c308d1371">\n                    <div class="form-group">\n                      <textarea name="topicComment[content]" class="form-control"></textarea>\n                    </div>\n                    <button type="submit" class="btn btn-primary">提交</button>\n                  </div>\n                </div>\n              </li>\n            </ul>\n          </div>\n        </div>')})}),$(".topic-del").on("click",function(e){e.preventDefault();var t=$(this),i=t.data("did");console.log("console.log(did)"),$.ajax({url:"/topic/:id?topicid="+i,type:"DELETE"}).done(function(e){1===e.success&&$("#box-"+i).remove()})}),$(".topicComments button").on("click",function(e){var t=this.parentNode.id;e.preventDefault(),$.ajax({url:"/admin/movie/movieTopicComment",type:"POST",data:{"topicComment[movie]":$("#"+t+' input[name="topicComment[movie]"]').val(),"topicComment[topicId]":$("#"+t+' input[name="topicComment[topicId]"]').val(),"topicComment[from]":$("#"+t+' input[name="topicComment[from]"]').val(),"topicComment[content]":$("#"+t+" textarea").val(),"topicComment[tid]":$("#topicToId").val(),"topicComment[cid]":$("#topicCommentId").val()}}).done(function(e){if(0===e.msg){var t=e.data||{};$("#topicMediaBody").parent().append('<div class="media">\n                      <div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 30px; height: 30px;" class="media-object"></div>\n                      <div class="media-body">\n                        <h4 class="topic-media-heading"><a>'+t.from.name+"</a><span>&nbsp;回复&nbsp;</span><a>"+t.to.name+"</a></h4>\n                        <p>"+t.content+'</p><span class="createAt">'+e.createAt+' &nbsp;&nbsp;&nbsp;&nbsp;</span><a href="javascript:;" data-cid='+e.commentsId+" data-crid="+e.commentsReplyId+" data-tid="+t.to._id+" data-topicid="+e.topicId+' class="topic-comment-reply">&nbsp;|&nbsp;回复</a><a href="javascript:;" data-cid='+e.commentsId+" data-crid="+e.commentsReplyId+" data-topicid="+e.topicId+' class="topic-comment-del">删除</a>\n                      </div>\n                    </div>'),$("#topicMediaBody").removeAttr("id"),$("#topicForm"+e.topicId+" input:gt(1)").remove(),$("#modal"+e.topicId+" textarea").val("").focus(),i()}else{var t=e.data||{},a=e.commentsId||{},n=e.topicId||{},o=e.createAt||{};$("#mediaList"+n).append('<li class="media"><div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 40px; height: 40px;" /></div><div class="media-body topic-comment-body"><div class="topic-comment-header"><h4 class="topic-media-heading"><a href="javascript:;">'+t.from.name+'</a><span class="createAt">'+o+' &nbsp;&nbsp;&nbsp;&nbsp;</span></h4></div><p class="topic-comment-content">'+t.content+'</p><div class="op-lnks"><a href="#comments" data-cid='+a+" data-tid="+t.from._id+" data-topicid="+n+' class="topic-comment-reply">回复</a><a href="javascript:;" data-cid='+a+" data-topicid="+n+" data-crid="+e.crId+' class="topic-comment-del">删除&nbsp;|&nbsp;</a></div>  </div><hr></li>'),i(),$("#modal"+n+" textarea").val("").focus()}})}),i(),$("#have-seen").on("click",function(e){e.preventDefault();var t=$('input[name="user[id]"]').val(),i=$('input[name="movie[id]"]').val();$.ajax({url:"/movieSee/:id?userId="+t+"&movieId="+i+"&seeId=1",type:"GET"}).done(function(e){if(console.log(e),$("#nobody-record")&&$("#nobody-record").remove(),e.msg){$("#record-body").append('<li class="media">\n                <div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 40px; height: 40px;" class="media-object"></div>\n                <div class="media-body">\n                  <h4 class="media-heading">'+e.name+"</h4>\n                  <p>"+e.createAt+"看过</p>\n                </div>\n                <hr>\n              </li>"),$("#have-seen").addClass("disabled"),$("#have-seen span").html("已看过");var t=$("#seen-number");t.html(parseInt(t.html())+1)}})}),$("#want-to-see").on("click",function(e){e.preventDefault();var t=$('input[name="user[id]"]').val(),i=$('input[name="movie[id]"]').val();$.ajax({url:"/movieSee/:id?userId="+t+"&movieId="+i+"&seeId=0",type:"GET"}).done(function(e){if($("#nobody-record")&&$("#nobody-record").remove(),"0"===e.msg){$("#nobody-record")&&$("#nobody-record").remove(),$("#record-body").append('<li class="media">\n                <div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 40px; height: 40px;" class="media-object"></div>\n                <div class="media-body">\n                  <h4 class="media-heading">'+e.name+"</h4>\n                  <p>"+e.createAt+"表示想看</p>\n                </div>\n                <hr>\n              </li>"),$("#want-to-see").addClass("disabled"),$("#want-to-see span").html("已想看");var t=$("#wanna-see-number");t.html(parseInt(t.html())+1)}})}),$(".inverted").on("click",function(e){e.preventDefault();var t=$(this),i=t.data("mid");window.open(i)})});