"use strict";$.support.cors=!0,$(function(){function t(t){return t<10?"0"+t:""+t}function e(e){return t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())}function a(){$(".topic-comment-del").off("click"),$(".topic-comment-reply").off("click"),$(".topic-comment-del").on("click",function(t){var e=$(this).parent().parent(),a=$(t.target).data("topicid"),i=$(t.target).data("cid"),n=$(t.target).data("crid");$.ajax({url:"/topicComment/:id?topicid="+a+"&cid="+i+"&crId="+n,type:"DELETE"}).done(function(t){0===t.success?e.remove():e.parent().remove()})}),$(".topic-comment-reply").on("click",function(t){t.preventDefault();var e=$(this),a=e.data("topicid"),i=e.data("cid"),n=e.data("tid");$("#topicMediaBody")&&$("#topicMediaBody").removeAttr("id"),$(e).parent().attr("id","topicMediaBody"),$("#topicToId").length>0&&$("#topicToId").remove(),$("<input>").attr({type:"hidden",id:"topicToId",name:"topicComment[tid]",value:n}).appendTo("#topicForm"+a),$("#topicCommentId").length>0&&$("#topicCommentId").remove(),$("<input>").attr({type:"hidden",id:"topicCommentId",name:"topicComment[cid]",value:i}).appendTo("#topicForm"+a),$("#modal"+a+" textarea").focus()})}var i=15*Math.ceil($(".rating-num strong").html()-10);$(".star").css("background-position-y",i),$("#mediaList").on("click",".comment",function(t){t.preventDefault();var e=$(this),a=e.data("tid"),i=e.data("cid");$(e).parents(".media-body").attr("id","mediaBody"),$("#toId").length>0?$("#toId").val(a):$("<input>").attr({type:"hidden",id:"toId",name:"comment[tid]",value:a}).appendTo("#commentForm"),$("#commentId").length>0?$("#commentId").val(i):$("<input>").attr({type:"hidden",id:"commentId",name:"comment[cid]",value:i}).appendTo("#commentForm"),$("#comments textarea").focus()}),$("#comments button").on("click",function(t){t.preventDefault(),$.ajax({url:"/admin/movie/movieComment",type:"POST",data:{"comment[movie]":$('#comments input[name="comment[movie]"]').val(),"comment[from]":$('#comments input[name="comment[from]"]').val(),"comment[content]":$("#comments textarea").val(),"comment[tid]":$("#toId").val(),"comment[cid]":$("#commentId").val()}}).done(function(t){var a=t.data||{};if(console.log(a),a.reply.length){var i=a.reply.length;$("#mediaBody").append('<div class="media"><div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 30px; height: 30px;"/></div><div class="media-body"><h4  class="media-heading">'+a.reply[i-1].from.name+"<span>&nbsp;回复&nbsp;</span>"+a.reply[i-1].to.name+"</h4><p>"+a.reply[i-1].content+'</p><span class="createAt">'+e(new Date)+'</span>&nbsp;&nbsp;&nbsp;&nbsp;<a class="comment" href="#comments" data-cid='+a._id+" data-tid="+a.reply[i-1].to._id+'> 回复</a>&nbsp;|&nbsp;<a class="comment-del" href="javascript:;" data-cid='+a._id+" data-did="+a.reply[i-1]._id+">删除</a></div></div>")}else{$("#mediaList").append('<li class="media"><div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 40px; height: 40px;" /></div><div class="media-body"><h4 class="media-heading">'+a.from.name+"</h4><p>"+a.content+'</p><span class="createAt">'+e(new Date)+'</span>&nbsp;&nbsp;&nbsp;&nbsp;<a class="comment" href="#comments" data-cid='+a._id+" data-tid="+a.from._id+'> 回复</a>&nbsp;|&nbsp;<a class="comment-del" href="javascript:;" data-cid='+a._id+">删除</a></div><hr></li>");try{var n=$("#comment-length");n.html(parseInt(n.html())+1)}catch(o){console.log(o)}}$("#comments textarea").val(""),$("#mediaBody").removeAttr("id"),$("#commentForm input:gt(1)").remove()})}),$("#mediaList").on("click",".comment-del",function(t){var e=$(this).parent(".media-body"),a=$(t.target).data("cid"),i=$(t.target).data("did");$.ajax({url:"/movie/:id?cid="+a+"&did="+i,type:"DELETE"}).done(function(t){if(1===t.success){e.parent().remove();try{var a=$("#comment-length");a.html(parseInt(a.html())-1)}catch(i){console.log(i)}}})}),$("#topic-guide-close").on("click",function(t){$("#topic-guide").hide()}),$("#publish-toppic-btn").on("click",function(t){$("#topic-publish-modal").modal("show")}),$(".show-modal-btn").on("click",function(t){console.log(this.id),$("#modal"+this.id).modal("show"),$("input").blur(),$("#bootstrapJs").hide()}),$("#publishButton").on("click",function(t){t.preventDefault(),$.ajax({url:"/admin/movie/movieTopic",type:"POST",dataType:"json",data:{"topic[movie]":$('#topic-publish-modal input[name="topic[movie]"]').val(),"topic[publisher]":$('#topic-publish-modal input[name="topic[publisher]"]').val(),"topic[title]":$('#topic-publish-modal input[name="topic[title]"]').val(),"topic[body]":$('#topic-publish-modal textarea[name="topic[body]"]').val()}}).done(function(t){var e=t.data||{},a=t.createAt||{};$("#topicBody").append("<h3><a id="+e._id+' href="javascript:void(0);"class="show-modal-btn">'+e.title+'</a></h3>\n<div><span class="tag">'+a+'</span><span class="tag right"><span>浏览(4)</span><span>留言(1)</span></span></div><hr>'),$(".show-modal-btn:last").on("click",function(t){$("#modal"+e._id).modal("show"),$("input").blur()}),$("#topic-hidden").append('<div id="modal'+e._id+'" class="ui modal publish large long"><i class="close icon"></i>\n          <div class="header">'+e.title+'</div>\n          <div class="content">\n            <form method="post" class="ui form segment">\n              <input type="hidden" name="topic[movie]" value="5c3e980c944b741c5097aafc">\n              <input type="hidden" name="topic[publisher]" value="5c7e5905434e9b0c308d1371">\n              <div class="field">\n                <label>内容</label>'+e.body+'              </div>\n            </form>\n          </div>\n          <div class="actions">\n            <ul class="media-list">\n              <li class="media">\n                <div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 40px; height: 40px;" class="media-object"></div>\n                <div class="media-body">\n                  <div class="topicComments">\n                    <form method="POST">\n                      <input type="hidden" name="topicComment[movie]" value="5c3e980c944b741c5097aafc">\n                      <input type="hidden" name="topicComment[topicId]" value="5c7fce0f2ae18018a41b90b5">\n                    </form>\n                    <input type="hidden" name="topicComment[from]" value="5c7e5905434e9b0c308d1371">\n                    <div class="form-group">\n                      <textarea name="topicComment[content]" class="form-control"></textarea>\n                    </div>\n                    <button type="submit" class="btn btn-primary">提交</button>\n                  </div>\n                </div>\n              </li>\n            </ul>\n          </div>\n        </div>')})}),$(".topicComments button").on("click",function(t){var e=this.parentNode.id;t.preventDefault(),$.ajax({url:"/admin/movie/movieTopicComment",type:"POST",data:{"topicComment[movie]":$("#"+e+' input[name="topicComment[movie]"]').val(),"topicComment[topicId]":$("#"+e+' input[name="topicComment[topicId]"]').val(),"topicComment[from]":$("#"+e+' input[name="topicComment[from]"]').val(),"topicComment[content]":$("#"+e+" textarea").val(),"topicComment[tid]":$("#topicToId").val(),"topicComment[cid]":$("#topicCommentId").val()}}).done(function(t){if(0===t.msg){var e=t.data||{};$("#topicMediaBody").parent().append('<div class="media">\n                      <div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 30px; height: 30px;" class="media-object"></div>\n                      <div class="media-body">\n                        <h4 class="topic-media-heading"><a>'+e.from.name+"</a><span>&nbsp;回复&nbsp;</span><a>"+e.to.name+"</a></h4>\n                        <p>"+e.content+'</p><span class="createAt">'+t.createAt+' &nbsp;&nbsp;&nbsp;&nbsp;</span><a href="javascript:;" data-cid='+t.commentsId+" data-crid="+t.commentsReplyId+" data-tid="+e.to._id+" data-topicid="+t.topicId+' class="topic-comment-reply">&nbsp;|&nbsp;回复</a><a href="javascript:;" data-cid='+t.commentsId+" data-crid="+t.commentsReplyId+" data-topicid="+t.topicId+' class="topic-comment-del">删除</a>\n                      </div>\n                    </div>'),$("#topicMediaBody").removeAttr("id"),$("#topicForm"+t.topicId+" input:gt(1)").remove(),$("#modal"+t.topicId+" textarea").val("").focus(),a()}else{var e=t.data||{},i=t.commentsId||{},n=t.topicId||{},o=t.createAt||{};$("#mediaList"+n).append('<li class="media"><div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 40px; height: 40px;" /></div><div class="media-body topic-comment-body"><div class="topic-comment-header"><h4 class="topic-media-heading"><a href="javascript:;">'+e.from.name+'</a><span class="createAt">'+o+' &nbsp;&nbsp;&nbsp;&nbsp;</span></h4></div><p class="topic-comment-content">'+e.content+'</p><div class="op-lnks"><a href="#comments" data-cid='+i+" data-tid="+e.from._id+" data-topicid="+n+' class="topic-comment-reply">回复</a><a href="javascript:;" data-cid='+i+" data-topicid="+n+" data-crid="+t.crId+' class="topic-comment-del">删除&nbsp;|&nbsp;</a></div>  </div><hr></li>'),a(),$("#modal"+n+" textarea").val("").focus()}})}),a()});