extends ../../includes/layout

block link
  link(href="/libs/css/include/detail.min.css" rel="stylesheet")
  link(href="/libs/css/movie/movie_index.min.css",rel="stylesheet")
block content
  .container#content
    .row
      .detail-header.col-md-6.col-md-offset-1.col-xs-6
        if movie
          span #{movie.title}
          span.year (#{movie.year})
          .detail-body.clearfix
            if movie.poster.indexOf('http:') > -1
              img(src="#{movie.poster}" alt="#{movie.title}")
            else
              // 电影海报为自行上传
              img(src="/upload/movie/#{movie.poster}" alt="#{movie.title}")
            .detail-info.dl-horizontal
              dt 又名:
              dd= movie.aka
              dt 导演:
              dd= movie.doctor
              dt 主演:
              dd= movie.casts
              dt 类型:
              dd= movie.genres
              dt 国家/地区:
              dd= movie.country
              dt 上映年份:
              dd= movie.year
            .rating
              span 酪枸评分
              div
                .rating-num
                  strong #{movie.rating}
                .rating-img.star
          h4 #{movie.title}剧情简介&nbsp;·&nbsp;·&nbsp;·&nbsp;·&nbsp;·&nbsp;·
          p.intro #{movie.summary}
      .detaile.col-md-5.col-xs-6
        if movie
          //embed(src="#{movie.flash}" allowFullScreen="true" quality="high" width="100%" height="400" align="middle" allowScriptAcess="always" type="application/x-shockwave-flash")
          video(preload="auto" autoplay="" controls="controls" width="100%" height="350" align="middle")
            source(src="#{movie.flash}" type="video/mp4")
          //<video id="player-html5-240074_html5_api" class="vjs-tech" tabindex="-1" preload="auto" autoplay="">
          //<source src="http://vt1.doubanio.com/201901151726/ee8e0b1884e4a7f529615a33be7dec7c/view/movie/M/402400074.mp4" title="" type="video/mp4">
          //</video>
    .row
      .detaile-content.col-md-5.col-md-offset-1.col-xs-6
        .panel.panel-defatul
          .panel-heading.clear-padding
            h4 #{movie.title}的短评&nbsp;·&nbsp;·&nbsp;·&nbsp;·&nbsp;·&nbsp;·（全部
              span#comment-length #{comments.length}
              span 条）
            #comments
              if movie
                form#commentForm(method="POST" action="/admin/movie/comment")
                  input(type="hidden" name="comment[movie]" value="#{movie._id}")
                if user
                  input(type="hidden" name="comment[from]" value="#{user._id}")
                .form-group
                  textarea.form-control(name="comment[content]")
                if user
                  button.btn.btn-primary(type='submit') 提交
                else
                  a.navbar-link(href="#" data-toggle="modal" data-target="#signinModal") 登录后评论
          .panel-body
            ul.media-list#mediaList
              if comments
                each item in comments
                  if item.from
                    li.media
                      .media-left
                        img.media-object(src="/libs/images/user/headImg.png" style="width: 40px; height: 40px;")
                      .media-body
                        h4.media-heading #{item.from.name}
                        p #{item.content}
                        span.createAt #{moment(item.meta.createAt).format('MM-DD HH:mm')} &nbsp;&nbsp;&nbsp;&nbsp;
                        a.comment(href="#comments" data-cid="#{item._id}" data-tid="#{item.from._id}") 回复
                        if user && item.from.name === user.name
                          a.comment-del(href="javascript:;" data-cid="#{item._id}") &nbsp;|&nbsp;删除
                        if item.reply && item.reply.length > 0
                          each reply in item.reply
                            .media
                              .media-left
                                img.media-object(src="/libs/images/user/headImg.png" style="width: 30px; height: 30px;")
                              .media-body
                                h4.media-heading
                                  | #{reply.from.name}
                                  span &nbsp;回复&nbsp;
                                  | #{reply.to.name}
                                p #{reply.content}
                                span.createAt #{moment(reply.meta.createAt).format('MM-DD HH:mm')} &nbsp;&nbsp;&nbsp;&nbsp;
                                a.comment(href="#comments" data-cid="#{item._id}" data-tid="#{reply.to._id}") 回复
                                if user && reply.from.name === user.name
                                  a.comment-del(href="javascript:;" data-cid="#{item._id}" data-did='#{reply._id}') &nbsp;|&nbsp;删除

        .panel.panel-defatul
          .panel-heading.clear-padding
            h4 #{movie.title}的话题&nbsp;·&nbsp;·&nbsp;·&nbsp;·&nbsp;·&nbsp;·（全部
              span#long-comment-length #{comments.length}
              span 条）
          #topic-guide.topic-guide(style='display: block;')
            img.ic_question(src='/libs/images/movie/movieDetail/icon_question.png')
            .tip_content
              .tip_title 什么是话题
              .tip_desc
                div 无论是一部作品、一个人，还是一件事，都往往可以衍生出许多不同的话题。将这些话题细分出来，分别进行讨论，会有更多收获。
            img.ic_guide(src='/libs/images/movie/movieDetail/icon_guide_arrow.png')
            img#topic-guide-close.ic_close(src='/libs/images/movie/movieDetail/close@3x.png')
          .panel-body #{movie.title}反映了哪些社会问题？

      // 预告片下方广告节点标签以及记录看过电影的人的标签
      .record-movie.col-md-5.col-md-offset-1.col-xs-6
        h4 谁在看这部电影&nbsp;·&nbsp;·&nbsp;·&nbsp;·&nbsp;·&nbsp;·
        .panel-body
          ul.media-list
            if comments
              each item in comments
                if item.from
                  li.media
                    .media-left
                      img.media-object(src="/libs/images/user/headImg.png" style="width: 40px; height: 40px;")
                    .media-body
                      h4.media-heading #{item.from.name}
                      p 3分钟前看过
                    hr
        a(href="/fullpage" target="_blank")
          img(src="/libs/images/movie/advertisements/1.jpg")
  script(src="/libs/scripts/js/movie/movie_detail.min.js")
